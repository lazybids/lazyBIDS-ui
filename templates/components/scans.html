<div class="flex-row w-full justify-between flex flex-row">
  <h2 class="text-xl text-white"> Scan views:</h2>
<div class="form-control w-36 ">
  
  <label class="label cursor-pointer">
    <span class="label-text">Sync scans</span>
    <input type="checkbox" class="toggle toggle-secondary" checked="checked" id="rememberMeToggle" />
  </label>
</div>
</div>
<script>
  document.getElementById('rememberMeToggle').addEventListener('change', function () {
    if (this.checked) {
      // Code to run when the checkbox is checked
      for (var i = 0; i < all_nvs.length; i++) {
        var all_other_nvs = [];
        for (var ii = 0; ii < all_nvs.length; ii++) {
          if (!(i === ii)) {
            all_other_nvs.push(all_nvs[ii])

          }
          all_nvs[i].broadcastTo(all_other_nvs, { "3d": true, "2d": true })
        }
      }} 
    else {
        // Code to run when the checkbox is unchecked
        for (var i = 0; i < all_nvs.length; i++) {
          all_nvs[i].broadcastTo([], { "3d": false, "2d": false })
        }
      }
    });
</script>

<div class="grid grid-cols-1 lg:grid-cols-3 justify-items-center width-full">
  {% for scan in scans %}
  <div class="max-h-[50rem] w-11/12 grow pb-16 m-4 rounded-lg bg-black shadow-2xl shadow-teal-500/50">
    <p class="px-8 py-2">{{scan.name}}</p>
    <canvas id={{scan.name}} left=0, top=0, position='relative' , flex='auto' ,height=480 width=640></canvas>
  </div>
  {% endfor %}

  {% for table in tables %}
  <div class="max-h-[50rem] w-11/12 grow pb-16 m-4 rounded-lg bg-black shadow-2xl shadow-teal-500/50 p-8">
    <p class="px-8 py-2 ">{{table.name}}.table</p>
    <div class="overflow-auto">
    {{table.table | safe}}
    </div>
  </div>
  {% endfor %}


</div>



<script async defer>
  var all_nvs = [];
  {% for scan in scans %}
  var volumeList = [
    // first object in array is background image
    {
      {% if exp_id %}
      url: "/dataset/{{ds_id}}/subject/{{s_id}}/session/{{exp_id}}/scan/{{scan.name}}/files/{{scan.fname}}",
      {% else %}
      url: "/dataset/{{ds_id}}/subject/{{s_id}}/scan/{{scan.name}}/files/{{scan.fname}}",
      {% endif %}
      // name: "some_image",
      // colorMap: "gray",
      // opacity: 1,
      // visible: true,
    }
  ]

  // Niivue will adjust the canvas to 100% of its parent container's size 
  // the parent element can be any size you want (small or large)
  var nv = new window.niivue.Niivue()
  nv.attachTo('{{scan.name}}') // the canvas element id
  nv.loadVolumes(volumeList)
  all_nvs.push(nv)
  {% endfor %}
  for (var i = 0; i < all_nvs.length; i++) {
    var all_other_nvs = [];
    for (var ii = 0; ii < all_nvs.length; ii++) {
      if (!(i === ii)) {
        all_other_nvs.push(all_nvs[ii])

      }
      all_nvs[i].broadcastTo(all_other_nvs, { "3d": true, "2d": true })
    }
    //Do something
  }
  // nv.setSliceType(nv.sliceTypeMultiPlanar) // press the "v" key to cycle through views
</script>


<!-- <script type="module" async="">
  import * as niivue from "https://niivue.github.io/niivue/dist/index.js"
// make an array of volumes to load
let volumeList = [
{
 url: "https://niivue.github.io/niivue-demo-images/mni152.nii.gz",
 colormap: "red", // see: https://niivue.github.io/niivue/colormaps.html
},
];
const nv = new niivue.Niivue();
nv.attachTo("sub-01_ses-01_T1w"); // attach to canvas with id="gl"
nv.loadVolumes(volumeList);
</script> -->